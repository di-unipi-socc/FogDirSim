swagger: '2.0'
info:
  title: APIs for Cisco's Fog Director
  description: |
    The APIs are extracted with best effort,
    we do not have the ambition to claim that the following
    are CISCO's Fog Director complete APIs.
  version: '0.0'
basePath: /api
consumes:
- application/json
produces:
- application/json
schemes:
- http
- https

definitions:
  alert:
    type: object
    properties:
      deviceId:
        type: string
      ipAddress:
        type: string
      appName:
        type: string
        description: myApp name
      type:
        type: string
      message:
        type: string
      time:
        type: integer
    required:
    - deviceId
    - ipAddress
    - appName
    - type
    - message
    - time
  device:
    allOf:
    - $ref: '#/definitions/deviceMinimal'
    - type: object
      properties:
        usedCPU:
          type: integer
        usedMEM:
          type: integer
        apps:
          type: array
          items:
            type: integer
    type: object
  deviceMinimal:
    properties:
      port:
        type: string
      ipAddress:
        type: string
      username:
        type: string
      password:
        type: string
    required:
    - port
    - ipAddress
    - username
    - password
    type: object
  localApp:
    type: object
    properties:
      creationDate:
        type: integer
      localAppId:
        type: string
      version:
        type: string
      published:
        type: string
        enum:
        - published
        - unpublished
      profileNeeded:
        type: string
        enum:
        - c1.tiny
        - c1.small
        - c1.medium
        - c1.large
        - c1.xlarge
      cpuUsage:
        type: integer
      memoryUsage:
        type: integer
      sourceAppName:
        type: string
    required:
    - creationDate
    - localAppId
    - version
    - published
    - profileNeeded
    - cpuUsage
    - memoryUsage
    - sourceAppName
  myApp:
    properties:
      myAppId:
        type: integer
      name:
        type: string
  applicationResourceAsk:
    type: object
    properties:
      cpu:
        type: integer
      memory:
        type: integer
      profile:
        type: string
        enum:
        - c1.tiny
        - c1.small
        - c1.medium
        - c1.large
        - c1.xlarge
    required:
    - cpu
    - memory
    - profile
  myAppActionDeployItem:
    type: object
    properties:
      deviceId:
        type: string
      resourceAsk:
        type: object
        properties:
          resources:
            $ref: '#/definitions/applicationResourceAsk'
  myAppActionDeploy:
    properties:
      devices:
        type: array
        items:
          $ref: '#/definitions/myAppActionDeployItem'
  myAppAction:
    properties:
      deploy:
        type: object
        $ref: '#/definitions/myAppActionDeploy'
      start:
        type: object
        additionalProperties: false
      stop:
        type: object
        additionalProperties: false
    minProperties: 1
    maxProperties: 1
    type: object

paths:
  /v1/appmgr/alerts:
    get:
      description: Retrieve all the currently available alerts
      responses:
        '200':
          description: HTTP/200
          schema:
            properties:
              data:
                type: array
                items:
                  $ref: '#/definitions/alert'
            required:
            - data
      security:
      - XTokenId: []

  /v1/appmgr/apps/{local_application_id}:{version}:
    delete:
      description: Remove the Application from the Local Store
      parameters:
      - name: local_application_id
        in: path
        required: true
        type: string
      - name: version
        in: path
        required: true
        type: string
      responses:
        '200':
          description: HTTP/200
      security:
      - XTokenId: []

  /v1/appmgr/devices:
    get:
      description: Retrieve the devices matching the filtering rules
      parameters:
      - in: query
        name: limit
        required: false
        type: integer
      - in: query
        name: offset
        required: false
        type: integer
      responses:
        '200':
          description: HTTP/200
          schema:
            properties:
              data:
                type: array
                items:
                  $ref: '#/definitions/device'
            required:
            - data
            type: object
      security:
      - XTokenId: []
    post:
      description: Add a Device on the Infrastructure
      parameters:
      - name: body
        in: body
        required: true
        schema:
          $ref: '#/definitions/deviceMinimal'
      responses:
        '200':
          description: HTTP/200
          schema:
            $ref: '#/definitions/device'
      security:
      - XTokenId: []

  /v1/appmgr/devices/{device_id}:
    delete:
      description: Remove the Device from the Infrastructure
      parameters:
      - in: path
        name: device_id
        type: string
        required: true
      responses:
        '200':
          description: Removed device
          schema:
            $ref: '#/definitions/device'
      security:
      - XTokenId: []

  /v1/appmgr/localapps:
    get:
      description: Retrive the Local Application available in the Local Store
      parameters:
      - in: query
        name: limit
        required: false
        type: integer
      - in: query
        name: offset
        required: false
        type: integer
      responses:
        '200':
          description: HTTP/200
          schema:
            properties:
              data:
                type: array
                items:
                  $ref: '#/definitions/localApp'
            required:
            - data
            type: object
      security:
      - XTokenId: []

  /v1/appmgr/localapps/{local_application_id}:{version}:
    put:
      description: Update the Application status (publish, unpublish)
      parameters:
      - name: local_application_id
        in: path
        required: true
        type: string
      - name: version
        in: path
        required: true
        type: string
      - name: body
        in: body
        required: true
        schema:
          $ref: '#/definitions/localApp'
      responses:
        '200':
          description: HTTP/200
          schema:
            $ref: '#/definitions/localApp'
      security:
      - XTokenId: []

  /v1/appmgr/localapps/upload:
    post:
      description: Upload the application archive to the Local Store
      consumes:
      - multipart/form-data
      parameters:
      - in: header
        name: X-Publish-On-Upload
        type: boolean
        required: false
      - in: formData
        name: file
        type: file
        required: true
      responses:
        '200':
          description: HTTP/200
          schema:
            $ref: '#/definitions/localApp'
      security:
      - XTokenId: []

  /v1/appmgr/myapps:
    post:
      description: Create a new deployment hook
      parameters:
      - in: query
        name: minjobs
        type: integer
        required: false
        description: Parameter added by FogDirSim to permit to specify minimal amount of job required to consider the myapp up and running
      responses:
        '200':
          description: MyApp correctly created
          schema:
            $ref: '#/definitions/myApp'
      security:
      - XTokenId: []

    get:
      description: Get the myapp created in the system
      parameters:
      - in: query
        name: searchByName
        type: string
        required: false
      responses:
        '200':
          description: HTTP/200
          schema:
            type: object
            properties:
              data:
                type: array
                items:
                  $ref: '#/definitions/myApp'
            required:
            - data
      security:
      - XTokenId: []

  /v1/appmgr/myapps/{my_app_id}:
    delete:
      description: Remove the myApp if it is not installed on any device, returns error otherwise
      parameters:
      - in: path
        name: my_app_id
        type: integer
        required: true
        description: myApp identifier to remove
      responses:
        '200':
          description: HTTP/200
          schema:
            $ref: '#/definitions/myApp'
      security:
      - XTokenId: []

  /v1/appmgr/myapps/{my_app_id}/action:
    post:
      description: Manage the myapp state applying action on it
      parameters:
      - in: path
        name: my_app_id
        type: integer
        required: true
        description: myApp identifier
      - in: query
        name: profile
        type: string
        enum:
        - a
        - b
        - c
        description: Simulator job intensitivy profile used to represent an heavy resources application usage
      - in: body
        name: body
        schema:
          $ref: '#/definitions/myAppAction'
      responses:
        '200':
          description: HTTP/200
      security:
      - XTokenId: []

  /v1/appmgr/tokenservice:
    get:
      parameters:
      - in: header
        name: Authorization
        type: string
        description: Basic Authentication Header
      responses:
        '200':
          description: HTTP/200
          schema:
            type: object
            properties:
              token:
                type: string
              expiryTime:
                type: integer
              serverEpochTime:
                type: integer
            required:
            - token
            - expiryTime
            - serverEpochTime

  /v1/appmgr/tokenservice/{token}:
    delete:
      parameters:
      - in: path
        name: token
        description: token to delete
        required: true
        type: string
      responses:
        '200':
          description: HTTP/200
      security:
      - XTokenId: []

securityDefinitions:
  XTokenId:
    description: >
      Token provided to the user during the login phase.
      The token will provide the right user context to the server.
    type: apiKey
    in: header
    name: X-Token-Id
